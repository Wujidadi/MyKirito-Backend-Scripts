#!/usr/bin/env php
<?php

chdir(__DIR__);

require_once './declarations.php';

# Composer 環境
shell_exec('composer install');

# 在 storage 目錄下建立必需的資料夾
$directories = [

    # 日誌（logs）類資料夾
    LOG_DIR,
    LOG_DIR . DIRECTORY_SEPARATOR . 'AutoAction',
    LOG_DIR . DIRECTORY_SEPARATOR . 'AutoChallenge',
    LOG_DIR . DIRECTORY_SEPARATOR . 'TelegramBot',
    LOG_DIR . DIRECTORY_SEPARATOR . 'TelegramBot' . DIRECTORY_SEPARATOR . 'AutoAction',
    LOG_DIR . DIRECTORY_SEPARATOR . 'TelegramBot' . DIRECTORY_SEPARATOR . 'AutoChallenge',

    # 回應及簡要日誌（responses）類資料夾
    STORAGE_DIR . DIRECTORY_SEPARATOR . 'responses' . DIRECTORY_SEPARATOR . 'PersonalOverview',
    STORAGE_DIR . DIRECTORY_SEPARATOR . 'responses' . DIRECTORY_SEPARATOR . 'ChallengeReport',
    STORAGE_DIR . DIRECTORY_SEPARATOR . 'responses' . DIRECTORY_SEPARATOR . 'AutoAction',
    STORAGE_DIR . DIRECTORY_SEPARATOR . 'responses' . DIRECTORY_SEPARATOR . 'AutoChallenge',
    STORAGE_DIR . DIRECTORY_SEPARATOR . 'responses' . DIRECTORY_SEPARATOR . 'TelegramBot'

];
foreach ($directories as $directory)
{
    if (!is_dir($directory) && !is_file($directory)) mkdir($directory);
}

# 產生設定檔
require_once STORAGE_DIR . DIRECTORY_SEPARATOR . 'configs' . DIRECTORY_SEPARATOR . 'codes' . DIRECTORY_SEPARATOR . 'generator.php';

# 產生玩家資料 PHP 設定檔
buildPlayerConfig();

# 產生 Telegram 機器人 PHP 設定檔
buildTelegramBotConfig();
